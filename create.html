<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>변형문제 생성 - 우등생이 되는 수학 변형문제</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>우등생이 되는 수학 변형문제</h1>
            <a href="index.html" class="back-link">← 홈으로</a>
        </header>

        <main class="main-content">
            <div class="form-container">
                <h2>변형문제 생성하기</h2>
                <p class="form-description">아래 항목을 선택하면 맞춤형 변형문제가 생성됩니다.</p>

                <form id="problemForm" onsubmit="handleSubmit(event)">
                    <!-- STEP 1: 학교급 선택 -->
                    <div class="form-step">
                        <h3>STEP 1. 학교급 선택</h3>
                        <div class="radio-group">
                            <label for="schoolLevel-elementary" class="radio-label">
                                <input id="schoolLevel-elementary" type="radio" name="schoolLevel" value="elementary" checked required>
                                <span>초등학교</span>
                            </label>
                            <label for="schoolLevel-middle" class="radio-label">
                                <input id="schoolLevel-middle" type="radio" name="schoolLevel" value="middle">
                                <span>중학교</span>
                            </label>
                        </div>
                    </div>

                    <!-- STEP 2: 학년 선택 -->
                    <div class="form-step">
                        <h3>STEP 2. 학년 선택</h3>
                        <div id="gradeGroup" class="radio-group">
                            <!-- 첫 줄: 1학년~3학년 -->
                            <label class="radio-label">
                                <input type="radio" name="grade" value="1" checked required>
                                <span>1학년</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="grade" value="2">
                                <span>2학년</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="grade" value="3">
                                <span>3학년</span>
                            </label>
                            <!-- 두 번째 줄: 4학년~6학년 -->
                            <label class="radio-label">
                                <input type="radio" name="grade" value="4">
                                <span>4학년</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="grade" value="5">
                                <span>5학년</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="grade" value="6">
                                <span>6학년</span>
                            </label>
                        </div>
                    </div>

                    <!-- STEP 3: 학기 선택 -->
                    <div class="form-step">
                        <h3>STEP 3. 학기 선택</h3>
                        <div class="radio-group">
                            <label id="semester1Wrap" for="semester-1" class="radio-label">
                                <input id="semester-1" type="radio" name="semester" value="1" checked required>
                                <span>1학기</span>
                            </label>
                            <label id="semester2Wrap" for="semester-2" class="radio-label">
                                <input id="semester-2" type="radio" name="semester" value="2">
                                <span>2학기</span>
                            </label>
                        </div>
                    </div>

                    <!-- STEP 4: 개념 선택 -->
                    <div class="form-step">
                        <h3>STEP 4. 개념 선택 <span class="hint">(여러 개 선택 가능)</span></h3>
                        <div id="conceptGroup" class="checkbox-group concept-list concept-selector">
                            <!-- 동적으로 생성됨 -->
                        </div>
                    </div>

                    <!-- STEP 5: 틀린 이유 선택 -->
                    <div class="form-step">
                        <h3>STEP 5. 틀린 이유 선택 <span class="hint">(최대 3개 선택 권장)</span></h3>
                        <div class="checkbox-group">
                            <label for="mistake-개념을 정확히 모름" class="checkbox-label">
                                <input id="mistake-개념을 정확히 모름" type="checkbox" name="mistake" value="개념을 정확히 모름">
                                <span>개념을 정확히 모름</span>
                            </label>
                            <label for="mistake-문제 해석을 잘못함" class="checkbox-label">
                                <input id="mistake-문제 해석을 잘못함" type="checkbox" name="mistake" value="문제 해석을 잘못함">
                                <span>문제 해석을 잘못함</span>
                            </label>
                            <label for="mistake-식을 잘못 세움" class="checkbox-label">
                                <input id="mistake-식을 잘못 세움" type="checkbox" name="mistake" value="식을 잘못 세움">
                                <span>식을 잘못 세움</span>
                            </label>
                            <label for="mistake-계산 실수" class="checkbox-label">
                                <input id="mistake-계산 실수" type="checkbox" name="mistake" value="계산 실수">
                                <span>계산 실수</span>
                            </label>
                            <label for="mistake-단계를 빨리 넘김" class="checkbox-label">
                                <input id="mistake-단계를 빨리 넘김" type="checkbox" name="mistake" value="단계를 빨리 넘김">
                                <span>단계를 빨리 넘김</span>
                            </label>
                            <label for="mistake-중요한 조건을 놓침" class="checkbox-label">
                                <input id="mistake-중요한 조건을 놓침" type="checkbox" name="mistake" value="중요한 조건을 놓침">
                                <span>중요한 조건을 놓침</span>
                            </label>
                            <label for="mistake-글을 충분히 읽지 않음" class="checkbox-label">
                                <input id="mistake-글을 충분히 읽지 않음" type="checkbox" name="mistake" value="글을 충분히 읽지 않음">
                                <span>글을 충분히 읽지 않음</span>
                            </label>
                            <label for="mistake-풀이 방향을 잘 모름" class="checkbox-label">
                                <input id="mistake-풀이 방향을 잘 모름" type="checkbox" name="mistake" value="풀이 방향을 잘 모름">
                                <span>풀이 방향을 잘 모름</span>
                            </label>
                        </div>
                    </div>

                    <!-- STEP 6: 문제 유형 선택 -->
                    <div class="form-step">
                        <h3>STEP 6. 원하는 문제 유형</h3>
                        <div class="radio-group">
                            <label for="problemType-기본형" class="radio-label">
                                <input id="problemType-기본형" type="radio" name="problemType" value="기본형" checked required>
                                <span>기본형</span>
                            </label>
                            <label for="problemType-쉬운 개념확인형" class="radio-label">
                                <input id="problemType-쉬운 개념확인형" type="radio" name="problemType" value="쉬운 개념확인형">
                                <span>쉬운 개념확인형</span>
                            </label>
                            <label for="problemType-실수 보완형" class="radio-label">
                                <input id="problemType-실수 보완형" type="radio" name="problemType" value="실수 보완형">
                                <span>실수 보완형</span>
                            </label>
                            <label for="problemType-응용 심화형" class="radio-label">
                                <input id="problemType-응용 심화형" type="radio" name="problemType" value="응용 심화형">
                                <span>응용 심화형</span>
                            </label>
                            <label for="problemType-단계별 풀이형" class="radio-label">
                                <input id="problemType-단계별 풀이형" type="radio" name="problemType" value="단계별 풀이형">
                                <span>단계별 풀이형(아주 천천히 진행)</span>
                            </label>
                            <label for="problemType-서술형 문제" class="radio-label">
                                <input id="problemType-서술형 문제" type="radio" name="problemType" value="서술형 문제">
                                <span>서술형 문제</span>
                            </label>
                        </div>
                    </div>

                    <!-- STEP 7: 항목당 문제 수 선택 -->
                    <div class="form-step">
                        <h3>STEP 7. 항목당 문제 수 선택</h3>
                        <div class="radio-group">
                            <label for="problemCount-3" class="radio-label">
                                <input id="problemCount-3" type="radio" name="problemCount" value="3" checked required>
                                <span>항목당 3개</span>
                            </label>
                            <label for="problemCount-5" class="radio-label">
                                <input id="problemCount-5" type="radio" name="problemCount" value="5">
                                <span>항목당 5개</span>
                            </label>
                            <label for="problemCount-7" class="radio-label">
                                <input id="problemCount-7" type="radio" name="problemCount" value="7">
                                <span>항목당 7개</span>
                            </label>
                        </div>
                        <div id="totalQuestionsDisplay" style="margin-top: 15px; padding: 12px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #4f46e5; display: none;">
                            <div style="font-weight: 600; color: #1e40af; margin-bottom: 4px;">총 문제 수 미리보기</div>
                            <div style="color: #1e3a8a; font-size: 0.95rem;">
                                선택 항목: <span id="selectedConceptsCount">0</span>개 / 
                                항목당: <span id="perConceptCount">3</span>개 / 
                                총 문제: <span id="totalQuestionsCount">0</span>개
                            </div>
                        </div>
                    </div>

                    <!-- 제출 버튼 -->
                    <div class="form-submit">
                        <button type="submit" class="btn btn-primary btn-large">
                            <span class="btn-icon">✨</span>
                            AI로 변형문제 생성하기
                        </button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script src="./curriculum_4to6.js"></script>
    <script src="./script.js"></script>
    <script>
        // 중학교 목차 데이터 로드 (동적 import) - script.js 로드 후 실행
        (async function() {
            try {
                const module = await import('./src/data/middleSchoolToc.js');
                window.MIDDLE_SCHOOL_TOC = module.MIDDLE_SCHOOL_TOC;
                console.log('Middle school TOC loaded');
                
                // script.js의 DOMContentLoaded가 실행된 후에 개념 목록 업데이트
                if (document.readyState === 'complete' || document.readyState === 'interactive') {
                    // 이미 로드된 경우 즉시 업데이트
                    if (typeof updateConceptList === 'function') {
                        await updateConceptList();
                    }
                } else {
                    // 아직 로딩 중이면 DOMContentLoaded 이벤트에서 처리됨
                    document.addEventListener('DOMContentLoaded', async function() {
                        if (typeof updateConceptList === 'function') {
                            await updateConceptList();
                        }
                    });
                }
            } catch (error) {
                console.error('Failed to load middle school TOC:', error);
                // 오류가 발생해도 개념 목록은 표시되도록 함
                if (typeof updateConceptList === 'function') {
                    await updateConceptList();
                }
            }
        })();
    </script>
</body>
</html>

