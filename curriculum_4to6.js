// 4~6학년 교육과정 데이터
// 5학년 2학기, 6학년 2학기는 개정으로 데이터 없음
const CURRICULUM_4_TO_6 = {
  "4학년": {
    "1학기": [
      {
        "unit": "1단원 : 큰 수",
        "topics": [
          "1) 다섯 자리 수 알아보기",
          "2) 십만, 백만, 천만 알아보기",
          "3) 억 알아보기",
          "4) 조 알아보기",
          "5) 뛰어 세기",
          "6) 수의 크기 비교하기"
        ]
      },
      {
        "unit": "2단원 : 각도",
        "topics": [
          "1) 각의 크기 비교, 각의 크기 재기",
          "2) 예각과 둔각 알아보기, 각도 어림하고 재기",
          "3) 각도의 합과 차",
          "4) 삼각형의 세 각의 크기의 합",
          "5) 사각형의 네 각의 크기의 합"
        ]
      },
      {
        "unit": "3단원: 곱셈과 나눗셈",
        "topics": [
          "1) 세 자리 수 × 몇십",
          "2) 세 자리 수 × 몇십몇",
          "3) 몇십으로 나누기",
          "4) 몇십몇으로 나누기 (1)",
          "5) 몇십몇으로 나누기 (2)"
        ]
      },
      {
        "unit": "4단원: 평면도형의 이동",
        "topics": [
          "1) 점의 이동",
          "2) 평면도형 밀기",
          "3) 평면도형 뒤집기",
          "4) 평면도형 돌리기",
          "5) 평면도형을 이동하여 무늬 꾸미기"
        ]
      },
      {
        "unit": "5단원: 막대 그래프",
        "topics": [
          "1) 막대그래프 알아보기",
          "2) 막대그래프 나타내기",
          "3) 막대그래프 활용하기"
        ]
      },
      {
        "unit": "6단원: 규칙 찾기",
        "topics": [
          "1) 수의 배열에서 규칙 찾기",
          "2) 모양의 배열에서 규칙 찾기",
          "3) 계산식의 배열에서 규칙 찾기",
          "4) 등호(=)가 있는 식 알아보기"
        ]
      }
    ],
    "2학기": [
      {
        "unit": "1단원: 분수의 덧셈과 뺄셈",
        "topics": [
          "1) 분수의 덧셈 (1)",
          "2) 분수의 덧셈 (2)",
          "3) 분수의 뺄셈 (1)",
          "4) 분수의 뺄셈 (2)",
          "5) 분수의 뺄셈 (3)"
        ]
      },
      {
        "unit": "2단원 : 삼각형",
        "topics": [
          "1) 삼각형을 변의 길이에 따라 분류하기",
          "2) 이등변삼각형과 정삼각형의 성질",
          "3) 삼각형을 각의 크기에 따라 분류하기",
          "4) 삼각형을 두 가지 기준으로 분류하기"
        ]
      },
      {
        "unit": "3단원 : 소수의 덧셈과 뺄셈",
        "topics": [
          "1) 소수 두 자리 수",
          "2) 소수 세 자리 수",
          "3) 소수의 크기 비교, 소수 사이의 관계",
          "4) 소수 한 자리 수의 덧셈",
          "5) 소수 두 자리 수의 덧셈",
          "6) 소수 한 자리 수의 뺄셈",
          "7) 소수 두 자리 수의 뺄셈"
        ]
      },
      {
        "unit": "4단원 : 사각형",
        "topics": [
          "1) 수직과 수선",
          "2) 평행과 평행선",
          "3) 평행선 사이의 거리",
          "4) 사다리꼴과 평행사변형",
          "5) 마름모",
          "6) 여러 가지 사각형"
        ]
      },
      {
        "unit": "5단원: 꺾은선그래프",
        "topics": [
          "1) 꺾은선그래프 알아보기",
          "2) 꺾은선그래프 내용 알아보기",
          "3) 꺾은선그래프 나타내기, 해석하기"
        ]
      },
      {
        "unit": "6단원: 다각형",
        "topics": [
          "1) 다각형과 정다각형 알아보기",
          "2) 대각선 알아보기",
          "3) 모양 만들기와 모양 채우기"
        ]
      }
    ]
  },
  "5학년": {
    "1학기": [
      {
        "unitId": "G5_S1_U1",
        "unit": "1단원 : 자연수의 혼합 계산",
        "topics": [
          { "topicId": "G5_S1_U1_T1", "title": "1) 덧셈과 뺄셈이 섞여 있는 식 계산하기" },
          { "topicId": "G5_S1_U1_T2", "title": "2) 곱셈과 나눗셈이 섞여 있는 식 계산하기" },
          { "topicId": "G5_S1_U1_T3", "title": "3) 덧셈, 뺄셈, 곱셈이 섞여 있는 식 계산하기" },
          { "topicId": "G5_S1_U1_T4", "title": "4) 덧셈, 뺄셈, 나눗셈이 섞여 있는 식 계산하기" },
          { "topicId": "G5_S1_U1_T5", "title": "5) 덧셈, 뺄셈, 곱셈, 나눗셈이 섞여 있는 식 계산하기" }
        ]
      },
      {
        "unitId": "G5_S1_U2",
        "unit": "2단원 : 약수와 배수",
        "topics": [
          { "topicId": "G5_S1_U2_T1", "title": "1) 약수 알아보기" },
          { "topicId": "G5_S1_U2_T2", "title": "2) 배수 알아보기" },
          { "topicId": "G5_S1_U2_T3", "title": "3) 약수와 배수의 관계 알아보기" },
          { "topicId": "G5_S1_U2_T4", "title": "4) 공약수와 최대공약수 알아보기" },
          { "topicId": "G5_S1_U2_T5", "title": "5) 최대공약수 구하는 방법 알아보기" },
          { "topicId": "G5_S1_U2_T6", "title": "6) 공배수와 최소공배수 알아보기" },
          { "topicId": "G5_S1_U2_T7", "title": "7) 최소공배수 구하는 방법 알아보기" }
        ]
      },
      {
        "unitId": "G5_S1_U3",
        "unit": "3단원 : 대응 관계",
        "topics": [
          { "topicId": "G5_S1_U3_T1", "title": "1) 두 양 사이의 관계 알아보기" },
          { "topicId": "G5_S1_U3_T2", "title": "2) 대응 관계를 식으로 나타내기" },
          { "topicId": "G5_S1_U3_T3", "title": "3) 생활 속에서 대응 관계를 찾아 식으로 나타내기" }
        ]
      },
      {
        "unitId": "G5_S1_U4",
        "unit": "4단원 : 약분과 통분",
        "topics": [
          { "topicId": "G5_S1_U4_T1", "title": "1) 크기가 같은 분수 알아보기" },
          { "topicId": "G5_S1_U4_T2", "title": "2) 크기가 같은 분수 만들기" },
          { "topicId": "G5_S1_U4_T3", "title": "3) 분수를 간단하게 나타내기" },
          { "topicId": "G5_S1_U4_T4", "title": "4) 분모가 같은 분수로 나타내기" },
          { "topicId": "G5_S1_U4_T5", "title": "5) 분수의 크기 비교하기" },
          { "topicId": "G5_S1_U4_T6", "title": "6) 분수와 소수의 크기 비교하기" }
        ]
      },
      {
        "unitId": "G5_S1_U5",
        "unit": "5단원 : 분수의 덧셈과 뺄셈",
        "topics": [
          { "topicId": "G5_S1_U5_T1", "title": "1) 진분수의 덧셈" },
          { "topicId": "G5_S1_U5_T2", "title": "2) 대분수의 덧셈" },
          { "topicId": "G5_S1_U5_T3", "title": "3) 진분수의 뺄셈" },
          { "topicId": "G5_S1_U5_T4", "title": "4) 대분수의 뺄셈" }
        ]
      },
      {
        "unitId": "G5_S1_U6",
        "unit": "6단원 : 다각형의 둘레와 넓이",
        "topics": [
          { "topicId": "G5_S1_U6_T1", "title": "1) 다각형의 둘레 구하기" },
          { "topicId": "G5_S1_U6_T2", "title": "2) 1 cm² 알아보기, 직사각형의 넓이 구하기" },
          { "topicId": "G5_S1_U6_T3", "title": "3) 1 cm² 보다 더 큰 넓이의 단위 알아보기" },
          { "topicId": "G5_S1_U6_T4", "title": "4) 평행사변형과 삼각형의 넓이 구하기" },
          { "topicId": "G5_S1_U6_T5", "title": "5) 마름모와 사다리꼴의 넓이 구하기" }
        ]
      }
    ]
    // 5학년 2학기는 개정으로 데이터 없음
  },
  "6학년": {
    "1학기": [
      {
        "unit": "1단원 : 분수의 나눗셈",
        "topics": [
          "1) (자연수)÷(자연수)의 몫을 분수로 나타내기(1)",
          "2) (자연수)÷(자연수)의 몫을 분수로 나타내기(2)",
          "3) (분수)÷(자연수) 알아보기",
          "4) (분수)÷(자연수)를 분수의 곱셈으로 나타내기",
          "5) (대분수)÷(자연수) 알아보기"
        ]
      },
      {
        "unit": "2단원 : 각기둥과 각뿔",
        "topics": [
          "1) 각기둥 알아보기(1)",
          "2) 각기둥 알아보기(2)",
          "3) 각기둥의 전개도",
          "4) 각뿔 알아보기(1)",
          "5) 각뿔 알아보기(2)"
        ]
      },
      {
        "unit": "3단원 : 소수의 나눗셈",
        "topics": [
          "1) (소수)÷(자연수)(1)",
          "2) (소수)÷(자연수)(2)",
          "3) (소수)÷(자연수)(3)",
          "4) (소수)÷(자연수)(4)",
          "5) (소수)÷(자연수)(5)",
          "6) (자연수)÷(자연수)"
        ]
      },
      {
        "unit": "4단원 : 비와 비율",
        "topics": [
          "1) 두 수 비교하기",
          "2) 비 알아보기",
          "3) 비율 알아보기, 비율이 사용되는 경우 알아보기",
          "4) 백분율 알아보기, 백분율이 사용되는 경우 알아보기"
        ]
      },
      {
        "unit": "5단원 : 여러 가지 그래프",
        "topics": [
          "1) 띠그래프 알아보기, 띠그래프로 나타내기",
          "2) 원그래프 알아보기, 원그래프로 나타내기",
          "3) 그래프 해석하기",
          "4) 여러 가지 그래프 비교하기"
        ]
      },
      {
        "unit": "6단원: 직육면체의 겉넓이와 부피",
        "topics": [
          "1) 직육면체의 겉넓이 구하기",
          "2) 1cm³ 알아보기",
          "3) 직육면체의 부피 구하기",
          "4) m³ 알아보기"
        ]
      }
    ]
    // 6학년 2학기는 개정으로 데이터 없음
  }
};

// ===============================
// STEP4: 단원별 2열 레이아웃(1-2 / 3-4 / 5-6)
// ===============================
function isUnitTitleEl(el) {
  if (!el || el.nodeType !== 1) return false;
  const tag = el.tagName.toLowerCase();
  const text = (el.textContent || "").trim();
  const looksLikeTitle =
    el.classList.contains("unit-title") ||
    el.classList.contains("section-title") ||
    tag === "h3" || tag === "h4" || tag === "h5";
  return looksLikeTitle && text.includes("단원");
}

function isConceptItemEl(el) {
  if (!el || el.nodeType !== 1) return false;
  return !!el.querySelector('input[type="checkbox"]');
}

function rebuildConceptGroupToUnitGrid() {
  const conceptGroup = document.getElementById("conceptGroup");
  if (!conceptGroup) return;

  const wrapper = conceptGroup.querySelector(":scope > div") || conceptGroup;
  const children = Array.from(wrapper.children);
  if (children.length === 0) return;

  const unitGrid = document.createElement("div");
  unitGrid.className = "unit-grid";

  let currentBlock = null;
  let currentItems = null;

  for (const el of children) {
    if (isUnitTitleEl(el)) {
      currentBlock = document.createElement("section");
      currentBlock.className = "unit-block";

      const titleEl = document.createElement("div");
      titleEl.className = "unit-title";
      titleEl.textContent = (el.textContent || "").trim();

      currentItems = document.createElement("div");
      currentItems.className = "unit-items";

      currentBlock.appendChild(titleEl);
      currentBlock.appendChild(currentItems);
      unitGrid.appendChild(currentBlock);
      continue;
    }

    if (isConceptItemEl(el) && currentItems) {
      currentItems.appendChild(el);
      continue;
    }
  }

  wrapper.innerHTML = "";
  wrapper.appendChild(unitGrid);
}

// 전역으로 노출(순서 문제로 not defined 방지)
window.rebuildConceptGroupToUnitGrid = rebuildConceptGroupToUnitGrid;
